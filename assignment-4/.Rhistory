sapply(as.numeric) %>%
as.matrix()
dist_matrix <- mahalanobis.dist(obs_matrix_2013)
rownames(dist_matrix) <- ces2013_clean$`ZIP Code`
colnames(dist_matrix) <- ces2013_clean$`ZIP Code`
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
) %>%
right_join(
ces2013_clean,
by = c("ZIP Code")
) %>%
arrange(match) %>%
.[1:11, ]
ces2013_clean$`ZIP Code`
typeof(ces2013_clean[1,1])
typeof(unlist(ces2013_clean[1,1])
ces2013_clean[1,1]
ces2013_clean[1,1] %>% as.character()
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
) %>%
right_join(
ces2013_clean %>% sapply(as.character()),
by = c("ZIP Code")
) %>%
arrange(match) %>%
.[1:11, ]
as.character()
ces2013_clean %>% sapply(as.character,
by = c("ZIP Code")
) %>%
arrange(match) %>%
.[1:11, ]
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
) %>%
right_join(
ces2013_clean %>% sapply(as.character),
by = c("ZIP Code")
) %>%
arrange(match) %>%
.[1:11, ]
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
) %>%
right_join(
ces2013_clean %>% sapply(as.character),
by = c("ZIP Code")
) %>%
arrange(match) %>%
.[1:11, ]
obs_matrix_2013 <-
ces2013_clean %>%
select(
`PM2.5 Pctl`,
`Diesel PM Pctl`,
`Asthma Pctl`
)%>%
as.matrix()
dist_matrix <- mahalanobis.dist(obs_matrix_2013)
%>%
obs_matrix_2013 <-
ces2013_clean %>%
select(
`PM2.5 Pctl`,
`Diesel PM Pctl`,
`Asthma Pctl`
) %>%
sapply(as.numeric) %>%
as.matrix()
dist_matrix <- mahalanobis.dist(obs_matrix_2013)
rownames(dist_matrix) <- ces2013_clean$`ZIP Code`
colnames(dist_matrix) <- ces2013_clean$`ZIP Code`
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
) %>%
right_join(
ces2013_clean %>% sapply(as.character),
by = c("ZIP Code")
) %>%
arrange(match) %>%
.[1:11, ]
dist_matrix["94545",]
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
) %>%
sapply(as.numeric) %>%
right_join(
ces2013_clean,
by = c("ZIP Code")
) %>%
arrange(match) %>%
.[1:11, ]
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
) %>%
right_join(
ces2013_clean,
by = c("ZIP Code")
) %>%
arrange(match) %>%
.[1:11, ]
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
) %>%
.[1] %>% sapply(as.numeric) %>%
right_join(
ces2013_clean,
by = c("ZIP Code")
) %>%
arrange(match) %>%
.[1:11, ]
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
) %>%
.[1,] %>% sapply(as.numeric) %>%
right_join(
ces2013_clean,
by = c("ZIP Code")
) %>%
arrange(match) %>%
.[1:11, ]
#
#   right_join(
#     ces2013_clean,
#     by = c("ZIP Code")
#   ) %>%
#   arrange(match) %>%
#   .[1:11, ]
match[,1] <- match[,1] %>% sapply(as.numeric)
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
)
match[,1] <- match[,1] %>% sapply(as.numeric)
match[1,1]
typeof(match[1,1])
match[,1] <- match[,1]
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
)
match[,1] <- match[,1]
typeof(match[1,1])
match <- match %>%
right_join(
ces2013_clean,
by = c("ZIP Code")
) %>%
arrange(match) %>%
.[1:11, ]
typeof(match[1,1])
obs_matrix_2013 <-
ces2013_clean %>%
select(
`PM2.5 Pctl`,
`Diesel PM Pctl`,
`Asthma Pctl`
) %>%
sapply(as.numeric) %>%
as.matrix()
dist_matrix <- mahalanobis.dist(obs_matrix_2013)
rownames(dist_matrix) <- ces2013_clean$`ZIP Code`
colnames(dist_matrix) <- ces2013_clean$`ZIP Code`
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
)
match[,1] <- match[,1] %>% sapply(as.numeric)
match <- match %>%
right_join(
ces2013_clean,
by = c("ZIP Code")
) %>%
arrange(match) %>%
.[1:11, ]
typeof(match[1,1])
ces2013 <- read_excel("ces2013.xls", sheet = 1)
ces2014 <- read_excel("ces2014.xlsx", sheet = 1)
ces2013_clean <-
ces2013 %>%
filter(
`PM2.5` != "NA",
`Diesel PM` != "NA",
`Asthma` != "NA"
) %>%
select(
`ZIP Code`,
`PM2.5`,
`Diesel PM`,
`Asthma`
)
ces2014_clean <-
ces2014 %>%
filter(
`PM2.5` != "NA",
`Diesel PM` != "NA",
`Asthma` != "NA"
) %>%
select(!`Census Tract`) %>%
group_by(ZIP) %>%
summarize(
`PM2.5` = mean(unlist(`PM2.5 Pctl`) %>% as.numeric()),
`Diesel PM` = mean(`Diesel PM Pctl`),
`Asthma` = mean(`Asthma Pctl`)
)
obs_matrix_2013 <-
ces2013_clean %>%
select(
`PM2.5`,
`Diesel PM`,
`Asthma`
) %>%
sapply(as.numeric) %>%
as.matrix()
dist_matrix <- mahalanobis.dist(obs_matrix_2013)
rownames(dist_matrix) <- ces2013_clean$`ZIP Code`
colnames(dist_matrix) <- ces2013_clean$`ZIP Code`
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
)
match[,1] <- match[,1] %>% sapply(as.numeric)
match <- match %>%
right_join(
ces2013_clean
) %>%
arrange(match) %>%
.[1:11, ]
View(match)
match_zips <-
match[-1,] %>%
select(-match) %>%
pivot_longer(
-`ZIP Code`,
names_to = "year",
values_to = "PM2.5"
)
match_zips <-
match[-1,] %>%
sapply(as.character) %>%
select(-match) %>%
pivot_longer(
-`ZIP Code`,
names_to = "year",
values_to = "PM2.5"
)
match_zips <-
match[-1,] %>%
sapply(as.character) %>%
as.data.frame() %>%
select(-match) %>%
pivot_longer(
-`ZIP Code`,
names_to = "year",
values_to = "PM2.5"
)
View(match_zips)
match_zips <-
match[-1,] %>%
sapply(as.character) %>%
as.data.frame() %>%
select(-match)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
library(tigris)
library(tidyverse)
library(tidycensus)
library(sf)
library(leaflet)
library(StatMatch)
library(readxl)
Sys.setenv(CENSUS_KEY = "c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
census_api_key("c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
ces2013 <- read_excel("ces2013.xls", sheet = 1)
ces2014 <- read_excel("ces2014.xlsx", sheet = 1)
ces2013_clean <-
ces2013 %>%
filter(
PM2.5 != "NA",
`Diesel PM` != "NA",
Asthma != "NA"
) %>%
select(
`ZIP Code`,
PM2.5,
`Diesel PM`,
Asthma
)
ces2014_clean <-
ces2014 %>%
filter(
PM2.5 != "NA",
`Diesel PM` != "NA",
Asthma != "NA"
) %>%
select(!`Census Tract`) %>%
group_by(ZIP) %>%
sumarize(
`PM2.5 = mean(unlist(`PM2.5 Pctl`) %>% as.numeric()),
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
library(tigris)
library(tidyverse)
library(tidycensus)
library(sf)
library(leaflet)
library(StatMatch)
library(readxl)
Sys.setenv(CENSUS_KEY = "c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
census_api_key("c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
ces2013 <- read_excel("ces2013.xls", sheet = 1)
ces2014 <- read_excel("ces2014.xlsx", sheet = 1)
ces2013_clean <-
ces2013 %>%
filter(
PM2.5 != "NA",
`Diesel PM` != "NA",
Asthma != "NA"
) %>%
select(
`ZIP Code`,
PM2.5,
`Diesel PM`,
Asthma
)
ces2014_clean <-
ces2014 %>%
filter(
PM2.5 != "NA",
`Diesel PM` != "NA",
Asthma != "NA"
) %>%
select(!`Census Tract`) %>%
group_by(ZIP) %>%
sumarize(
PM2.5 = mean(unlist(PM2.5) %>% as.numeric()),
`Diesel PM` = mean(`Diesel PM`),
Asthma = mean(Asthma)
)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
library(tigris)
library(tidyverse)
library(tidycensus)
library(sf)
library(leaflet)
library(StatMatch)
library(readxl)
Sys.setenv(CENSUS_KEY = "c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
census_api_key("c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
ces2013 <- read_excel("ces2013.xls", sheet = 1)
ces2014 <- read_excel("ces2014.xlsx", sheet = 1)
ces2013_clean <-
ces2013 %>%
filter(
PM2.5 != "NA",
`Diesel PM` != "NA",
Asthma != "NA"
) %>%
select(
`ZIP Code`,
PM2.5,
`Diesel PM`,
Asthma
)
ces2014_clean <-
ces2014 %>%
filter(
PM2.5 != "NA",
`Diesel PM` != "NA",
Asthma != "NA"
) %>%
select(!`Census Tract`) %>%
group_by(ZIP) %>%
summarize(
PM2.5 = mean(unlist(PM2.5) %>% as.numeric()),
`Diesel PM` = mean(`Diesel PM`),
Asthma = mean(Asthma)
)
obs_matrix_2013 <-
ces2013_clean %>%
select(
PM2.5,
`Diesel PM`,
Asthma
) %>%
sapply(as.numeric) %>%
as.matrix()
dist_matrix <- mahalanobis.dist(obs_matrix_2013)
rownames(dist_matrix) <- ces2013_clean$`ZIP Code`
colnames(dist_matrix) <- ces2013_clean$`ZIP Code`
match <- dist_matrix["94545",] %>%
as.data.frame() %>%
rownames_to_column() %>%
rename(
`ZIP Code` = rowname,
match = "."
)
match[,1] <- match[,1] %>% sapply(as.numeric)
match <- match %>%
right_join(
ces2013_clean
) %>%
arrange(match) %>%
.[1:11, ]
match_zips <-
match[-1,] %>%
sapply(as.character) %>%
as.data.frame() %>%
select(-match) %>%
group_by(
`ZIP Code`
) %>%
summarize(
PM2.5 = mean(PM2.5),
diesel_pm = mean(`Diesel PM`),
asthma = mean(Asthma)
zip = "Similar PUMAs"
match_zips <-
match[-1,] %>%
sapply(as.character) %>%
as.data.frame() %>%
select(-match) %>%
group_by(
`ZIP Code`
) %>%
summarize(
PM2.5 = mean(PM2.5),
diesel_pm = mean(`Diesel PM`),
asthma = mean(Asthma),
zip = "Similar PUMAs"
)
match_zips <-
match[-1,] %>%
select(-match) %>%
group_by(
`ZIP Code`
) %>%
summarize(
PM2.5 = mean(PM2.5),
diesel_pm = mean(`Diesel PM`),
asthma = mean(Asthma),
`ZIP Code` = "Control Zips"
)
typeof(match[1,1])
typeof(match[2,2])
typeof(match[3,3])
match_zips <-
match[-1,] %>%
select(-match) %>%
group_by(
`ZIP Code`
) %>%
summarize(
PM2.5 = mean(PM2.5 %>% as.numeric()),
diesel_pm = mean(`Diesel PM`),
asthma = mean(Asthma  %>% as.numeric()),
`ZIP Code` = "Control Zips"
)
match_zips <-
match[-1,] %>%
select(-match) %>%
group_by(
`ZIP Code`
)
